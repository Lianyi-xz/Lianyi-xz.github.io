title: Docker Swarm(集群)
tags: Docker
categories: 运维
date: 2018-01-30
---
### Swarm模式
  * Docker1.12.0或更高版本
  * 使用Docker CLI 创建Swarm，将应用程序部署到swarm，并管理swarm行为
  * 当前版本Docker包含swarm模式，用于本地管理的docker引擎集群被称为swarm

### swarm概念
  * swarm是由多个Docker主机组成，这些主机以swarm模式运行
  * 分为管理者(管理成员和委托)和工作者(运行swarm服务)
  * 给定Docker主机可以是管理者、工作者，或执行这两个角色

  * 修改服务配置，无需重新启动服务
  * 可在参与swarm的任何Docker主机以及swarm服务商运行独立容器
  * 可以定义并运行swarm服务

<!-- more -->

### 节点
  * 节点是docker引擎参与swarm的一个实例，可视为Docker节点
  * 可在单台物理计算机或云服务器上运行一个或多个节点
  * 生产swarm部署通常包括分布在多台物理机和云计算机上的Docker节点
  * 若将应用程序部署到swarm，需要将服务定义提交给管理节点，管理节点将称为任务的工作单元分配给工作节点
  
### 服务和任务
  * 服务是任务的定义，在管理或工作节点执行
  * 创建服务时，指定使用那个容器镜像以及在运行容器中执行那些命令
  * 对于复制服务模型，swarm管理器根据所需状态中设置的比例在节点之间分配指定数量的副本任务
  * 对于全局服务，swarm在集群中的每个可用节点上运行一项服务任务
  * 一个任务携带Docker容器和在容器内运行的命令，是swarm的原子调度单位。
  * 管理器节点根绝服务规模中设置的副本数量将任务分配给工作节点，一旦任务分配给一个节点，他就不能移动到另一个节点，只能在分配的节点上运行或失败。

### 负载均衡
  * swarm管理器使用入口负载均衡来暴露对swarm外部提供的服务
  * swarm管理器可自动将服务分配给一个PublishedPort(30000-32767)，可配置
  * 外部组件可以访问swarm中任何节点的已发布端口上的服务
  * Swarm模式有一个内部的DNS组件，可以自动为swarm中的每个服务配置一个DNS条目